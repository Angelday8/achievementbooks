machine:
  java:
    version: openjdk7

dependencies:
  override:
    - ./gradlew dependencies setupCIWorkspace
    - ./gradlew compileTestJava
  cache_directories:
    - ~/.gradle

compile:
  override:
    - export DIST_DIR=$CIRCLE_ARTIFACTS
    - ./gradlew processResources assemble collect

test:
  override:
    - ./gradlew test

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*(-.*)*/
    commands:
      - ./deploy.sh release $CIRCLE_TAG $CIRCLE_BUILD_NUM
  beta:
      branch: master
      commands:
        - ./deploy.sh beta $CIRCLE_BRANCH $CIRCLE_BUILD_NUM
